<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">Products - ArkVision</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../styles/main-simple.css">
  <script>fetch("../navigation.html")
  .then(res => res.text())
  .then(data => {
    const navPlaceholder = document.getElementById("navigation-placeholder");
    navPlaceholder.innerHTML = data;

    // Mobile menu toggle
    const toggle = navPlaceholder.querySelector("#navToggle");
    const menu = navPlaceholder.querySelector("#navMenu");

    toggle.addEventListener("click", () => {
      menu.classList.toggle("open");
    });

    navPlaceholder.querySelectorAll(".nav-menu a").forEach(link => {
  // Convert relative links to root-based links
  const href = link.getAttribute("href");
  if (!href.startsWith("http") && !href.startsWith("/")) {
    link.setAttribute("href", "/" + href);
  }

  // Highlight active link
  if (href === window.location.pathname.split("/").pop()) {
    link.classList.add("active");
  }
});

  });
</script>
</head>
<style> 

    .breadcrumb {
      padding: 0;
      margin-bottom: 1rem;

    }

    .breadcrumb-item+.breadcrumb-item::before {
           
    color: #fff !important;
    
    }

    
    
    .active {
      color: var(--primary-color) !important;
      text-decoration: none;
    }

   
   .pagination .page-item .page-link {
    color:  #fff;               
    background-color: var(--primary-color); 
    border: 1px solid var(--accent);    
  }

  .pagination .page-item .page-link:hover {
    color: #fff;
    background-color: var(--accent);
  
  }

  .pagination .page-item.active .page-link {
    color: #fff;
    background-color: var(--accent);
    border-color: var(--accent) !important;
  }

  .pagination .page-item.disabled .page-link {
    color: #999;
    background-color: rgba(0, 0, 0, 0.4);
    border-color: var(--accent);
  }

</style>
<body>
    <!-- Header & Navigation -->
    <header class="site-header">
      <div id="navigation-placeholder"></div>
    </header>

    <!-- Page hero -->
    <section class="page-hero" style="background-image: url('../assets/images/hero1.png');">
      <div class="page-hero-content">
        <h1 id="categoryTitle">Our Products</h1>
        <p>Discover our premium marine spare parts and equipment</p>
        
      </div>
    </section>

    <!-- Products Section -->
    <section class="py-5">
      <div class="container">
        <div class="row">
          <div class="col-12">
                        <nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="../blog.html">Blog</a></li>
    <li class="breadcrumb-item active" aria-current="page" id="breadcrumbCategory">Product</li>
  </ol>
</nav>
            <h3 class="text-left mb-5">Our Finest Solutions</h3>
            
            <!-- Search Section -->
            <div class="row justify-content-center mb-5">
              <div class="col-md-8 col-lg-6">
               <div class="product-search">
          <input type="text" id="searchInput" placeholder="Search products..." aria-label="Search products" />
        </div>
              </div>
            </div>

            <!-- Loading indicator -->
            <div class="text-center mb-4" id="loadingIndicator">
              <output class="spinner-border text-primary">
                <span class="visually-hidden">Loading...</span>
              </output>
              <p class="mt-2">Loading products...</p>
            </div>

            <!-- Error message -->
            <div class="alert alert-warning text-center" id="errorMessage" style="display: none;">
              <h5>Products not found</h5>
              <p>Unable to load products for this category. Please try again later.</p>
            </div>

            <!-- Products Grid -->
            <div class="row" id="productsGrid">
              <!--  dynamically loaded here -->
            </div>

            <!-- Pagination -->
<nav class="d-flex justify-content-center mt-4" style="background-color: var(--primary);">
  <ul class="pagination" id="pagination"></ul>
</nav>

            <!-- No results message -->
            <div class="text-center" id="noResultsMessage" style="display: none;">
              <h5>No products found</h5>
              <p>Try adjusting your search criteria.</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Product Detail Modal -->
    <div class="modal fade" id="productDetailModal" tabindex="-1" aria-labelledby="productDetailModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="productDetailModalLabel" style="color:#333">Product Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="productDetailContent">
            <!-- Product details  -->
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
           
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
      <div class="container footer-inner">
        <div class="footer-about">
          <h4>ArkVision</h4>
          <p>
            Pioneering the next generation of maritime technology. Our passion
            for engineering meets the power of the sea to deliver solutions
            that stand the test of time.
          </p>
        </div>
        <div class="footer-links">
          <h4>Explore</h4>
          <ul>
            <li><a href="about.html">About</a></li>
            <li><a href="products.html">Products</a></li>
            <li><a href="contact.html">Contact</a></li>
            <li><a href="index.html">Home</a></li>
             <li><a href="blog.html">Blogs</a></li>
          </ul>
        </div>
        <div class="footer-contact">
          <h4>Contact</h4>
          <ul>
            <li>Phone: +65 6123 4567</li>
            <li>Email: info@arkvision.com</li>
            <li>Address: 1 Maritime Drive, Singapore 018989</li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 ArkVision. All rights reserved.</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module">
  import { performSearch } from "../scripts/modules/keyword-search.js";

  // Global variables
  let allProducts = [];
  let filteredProducts = [];
  let currentCategory = "";

  // Category mapping
  const categoryMapping = {
    "electrical-items": { file: "electric_items.json", title: "Electrical Items" },
    "hydraulic-motor-pumps": { file: "hydraulic_pumps.json", title: "Hydraulic Motor & Pumps" },
    nozzle: { file: "nozle.json", title: "Nozzles" },
    pumps: { file: "pumps.json", title: "Pumps" },
    turbochargers: { file: "turbochargers.json", title: "Turbochargers" },
    "main-engine-two-stroke": { file: "two_strokes.json", title: "Main Engine (Two Stroke)" },
    "main-engine-four-stroke": { file: "four_stroke.json", title: "Main Engine (Four Stroke)" },
    governor: { file: "governor.json", title: "Governor" },
  };

  // Get category
  function getCategoryFromURL() {
    const path = window.location.pathname;
    const filename = path.split("/").pop().replace(".html", "");
    return filename;
  }

  // Load products
  async function loadProducts() {
    try {
      currentCategory = getCategoryFromURL();
      const categoryInfo = categoryMapping[currentCategory];

      if (!categoryInfo) throw new Error("Category not found");

      // Update page title and breadcrumb
      document.getElementById("pageTitle").textContent = `${categoryInfo.title} - ArkVision`;
      document.getElementById("categoryTitle").textContent = categoryInfo.title;
      document.getElementById("breadcrumbCategory").textContent = categoryInfo.title;

      const response = await fetch(`../assets/blog_data/${categoryInfo.file}`);
      if (!response.ok) throw new Error("Failed to fetch products");

      allProducts = await response.json();
      filteredProducts = [...allProducts];

      document.getElementById("loadingIndicator").style.display = "none";
      displayProducts();
    } catch (error) {
      console.error("Error loading products:", error);
      document.getElementById("loadingIndicator").style.display = "none";
      document.getElementById("errorMessage").style.display = "block";
    }
  }

  let currentPage = 1;
  const itemsPerPage = 24;

  // Display products in grid
  function displayProducts(page = 1) {
    currentPage = page;
    const productsGrid = document.getElementById("productsGrid");
    const noResultsMessage = document.getElementById("noResultsMessage");

    if (filteredProducts.length === 0) {
      productsGrid.innerHTML = "";
      noResultsMessage.style.display = "block";
      document.getElementById("pagination").innerHTML = "";
      return;
    }

    const startIndex = (page - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const paginatedProducts = filteredProducts.slice(startIndex, endIndex);

    noResultsMessage.style.display = "none";

    productsGrid.innerHTML = paginatedProducts
      .map(
        (product) => `
          <div class="col-sm-6 col-md-6 col-lg-4 col-xl-2 mb-4">
            <div class="product-item-blog-detail h-100 shadow-sm" 
                 style="cursor: pointer;" 
                 onclick="showProductDetail(${product.id})">
              <div class="card-img-top d-flex align-items-center justify-content-center">
                <img src="${product.imageUrl}" 
                     alt="${product.name}" 
                     class="img-fluid"
                     style="max-height: 160px; width: 100%; object-fit: contain;"
                     onerror="this.src='../assets/images/no-image.jpg'">
              </div>
              <div class="card-body d-flex flex-column align-items-center">
                <h6 class="card-title text-center pt-2">${product.name}</h6>
              </div>
            </div>
          </div>
        `
      )
      .join("");

    renderPagination();
  }

  // Pagination
  function renderPagination() {
    const pagination = document.getElementById("pagination");
    const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
    if (totalPages <= 1) {
      pagination.innerHTML = "";
      return;
    }

    let buttons = `
      <li class="page-item ${currentPage === 1 ? "disabled" : ""}">
        <a class="page-link" href="#" onclick="displayProducts(${currentPage - 1}); return false;">Previous</a>
      </li>
    `;

    for (let i = 1; i <= totalPages; i++) {
      buttons += `
        <li class="page-item ${i === currentPage ? "active" : ""}">
          <a class="page-link" href="#" onclick="displayProducts(${i}); return false;">${i}</a>
        </li>
      `;
    }

    buttons += `
      <li class="page-item ${currentPage === totalPages ? "disabled" : ""}">
        <a class="page-link" href="#" onclick="displayProducts(${currentPage + 1}); return false;">Next</a>
      </li>
    `;

    pagination.innerHTML = buttons;
  }

  // Product details modal
  function showProductDetail(productId) {
    const product = allProducts.find((p) => p.id === productId);
    if (!product) return;

    const modalContent = document.getElementById("productDetailContent");
    modalContent.innerHTML = `
      <div class="row bg-transparent">
        <div class="col-md-5">
          <img src="${product.imageUrl}" alt="${product.name}" class="img-fluid rounded"
               onerror="this.src='https://via.placeholder.com/400x300/6c757d/ffffff?text=No+Image'">
        </div>
        <div class="col-md-7">
          <h4 style="color:#000">${product.name}</h4>
          <table class="table table-borderless">
            <tr><td><strong>Make:</strong></td><td>${product.make || "N/A"}</td></tr>
            <tr><td><strong>Model:</strong></td><td>${product.model || "N/A"}</td></tr>
            <tr><td><strong>Condition:</strong></td><td>${product.condition || "N/A"}</td></tr>
            <tr><td><strong>Quantity:</strong></td><td>${product.qty || "1 unit"}</td></tr>
            <tr><td><strong>Price:</strong></td><td class="text-success fw-bold">${product.price || "Contact for price"}</td></tr>
          </table>
          <div class="mt-3">
            <h6 style="color: #999">Description:</h6>
            <p style="color: #a1a1a1">${product.description}</p>
          </div>
        </div>
      </div>
    `;
    document.getElementById("productDetailModalLabel").textContent = product.name;
    new bootstrap.Modal(document.getElementById("productDetailModal")).show();
  }

  // ✅ Use imported performSearch
  function handleSearch() {
    const searchTerm = document.getElementById("searchInput").value;
    performSearch(allProducts, searchTerm, ["name", "make", "model", "description"], (results) => {
      filteredProducts = results;
      displayProducts();
    });
  }

  // Event listeners
  document.addEventListener("DOMContentLoaded", function () {
    loadProducts();

    const input = document.getElementById("searchInput");
    let searchTimeout;

    input.addEventListener("keyup", (event) => {
      if (event.key === "Enter") handleSearch();
    });

    input.addEventListener("input", () => {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(handleSearch, 300);
    });
  });
</script>
</body>

</html>
